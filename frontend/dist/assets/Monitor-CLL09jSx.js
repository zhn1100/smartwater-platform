import{r as f,m as Ce,a as B,n as $e,p as Qe,q as Xe,s as Ze,c as U,b as t,d as l,t as Le,v as Me,e as p,x as g,f as et,y as tt,w as v,z as Te,u as at,o as P,j as w,F as De,A as ze,E as j,B as Ae,C as ot}from"./index-DqFTSyCM.js";import{g as nt,a as lt,b as st,c as D,i as H,L as q}from"./monitoring_new-CLirQ8xF.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";const rt={class:"top-bar"},ct={class:"user-section"},dt={class:"user-info"},ut={class:"user-details"},mt={class:"username"},ft={class:"user-role"},vt={class:"time-display"},_t={class:"current-time"},ht={class:"current-date"},yt={class:"window-header"},pt={class:"window-controls"},gt={class:"window-content"},xt={class:"stats-grid"},bt={class:"stat-item"},wt={class:"stat-item"},St={class:"stat-item"},Ct={class:"stat-item"},$t={class:"monitoring-types"},Lt={class:"additional-charts"},Mt={class:"chart-section"},Tt={class:"chart-header"},Dt={class:"chart-controls"},zt={class:"chart-section"},At={class:"chart-header"},Ft={class:"chart-controls"},Vt={class:"window-header"},Et={class:"window-controls"},kt={class:"window-content"},Bt={class:"points-list"},Pt=["onClick"],Nt={class:"point-info"},Rt={class:"point-name"},It={class:"point-details"},Ot={class:"point-type"},Ut={class:"point-instrument"},Gt={class:"point-value"},Wt={class:"value"},Yt={class:"unit"},jt={key:0,class:"point-detail"},Ht={class:"dynamic-chart"},qt={class:"chart-header"},Kt={class:"chart-controls"},Jt={class:"dynamic-chart"},Qt={class:"historical-data-section"},Xt={class:"section-header"},Zt={class:"section-controls"},ea={class:"measurements-table"},ta={class:"table-footer"},aa={class:"window-content"},oa={class:"scroll-board-container"},na={class:"window-content"},la={class:"model-controls"},sa={class:"model-info"},ia={class:"info-item"},ra={class:"value"},ca={class:"info-item"},da={class:"value"},ua={__name:"Monitor",setup(ma){const ie=at(),K=f(null),z=f({}),Fe=Ce(()=>`https://api.dicebear.com/7.x/avataaars/svg?seed=${z.value.username||"user"}`),N=f("dam1"),Ve={dam1:"大坝模型1",dam2:"大坝模型2",dam3:"大坝模型3"},Ee={dam1:"GLB格式",dam2:"GLB格式",dam3:"GLB格式"},A=f({}),re=f([]),R=f([]),ke=f([]),G=f("all"),ce=f(null),L=f(null),W=f([]),I=f(!1),F=f("2024"),V=f("2024"),$=f("month"),J=f(null),Q=f(null),X=f(null),Z=f(null);let E=null,k=null,M=null,T=null;const de=f(""),ue=f(""),ee=B({number:[0],content:"{nt}",style:{fontSize:24,fill:"#fff",fontWeight:"bold"},formatter:a=>a.toLocaleString()}),te=B({number:[0],content:"{nt}",style:{fontSize:24,fill:"#fff",fontWeight:"bold"}}),ae=B({number:[0],content:"{nt}",style:{fontSize:24,fill:"#fff",fontWeight:"bold"}}),Be=B({number:[0],content:"{nt}",style:{fontSize:18,fill:"#fff",fontWeight:"bold"},formatter:a=>"2024-2025"}),oe=B({data:[],digitalFlopStyle:{fontSize:14},color:["#5B8FF9","#5AD8A6","#F6BD16","#6F5EF9","#E86452","#945FB9","#FF9845","#1E9493"],showOriginValue:!0}),me=B({data:[],rowNum:5,waitTime:3e3,carousel:"single",unit:"mm"}),fe=B({data:[],header:["测量时间","监测类型","仪器编号","测量值"],headerBGC:"rgba(11, 25, 55, 0.9)",oddRowBGC:"rgba(11, 25, 55, 0.7)",evenRowBGC:"rgba(16, 36, 78, 0.7)",headerHeight:40,rowNum:5,columnWidth:[120,80,70,70],align:["center","center","center","center"]});let x=null,O=null,Y=new Map;const Pe=Ce(()=>G.value==="all"?R.value:R.value.filter(a=>a.type_id==G.value)),ve=()=>{const a=new Date;de.value=a.toLocaleTimeString("zh-CN"),ue.value=a.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})},Ne=()=>{ie.push("/admin")},Re=async()=>{try{await ot(),ie.push("/login")}catch(a){console.error("登出失败:",a)}},Ie=async()=>{try{await Promise.all([_e(),he(),ye(),pe()]),j.success("数据已刷新")}catch(a){console.error("刷新数据失败:",a),j.error("刷新数据失败")}},_e=async()=>{try{A.value=await nt(),ee.number=[A.value.total_measurements||0],te.number=[A.value.instrument_count||0];const a=A.value.type_statistics?A.value.type_statistics.length:0;ae.number=[a],A.value.type_statistics&&(oe.data=A.value.type_statistics.map(e=>({name:e.name,value:e.count})))}catch(a){console.error("加载统计数据失败:",a),ee.number=[0],te.number=[0],ae.number=[0],oe.data=[]}},he=async()=>{try{re.value=await lt()}catch(a){console.error("加载监测类型失败:",a)}},ye=async()=>{try{const a=await st(),e=[];for(const n of a)try{const i=await D({instrument_id:n.instrument_id,limit:1,order_by:"measure_time desc"});e.push({id:e.length+1,instrument_id:n.instrument_id,name:`仪器 ${n.instrument_id}`,type_id:n.type_id,type_name:n.type_name,latest_value:i.length>0?i[0].value:null,unit:n.unit||"mm"})}catch(i){console.error(`获取仪器 ${n.instrument_id} 最新数据失败:`,i),e.push({id:e.length+1,instrument_id:n.instrument_id,name:`仪器 ${n.instrument_id}`,type_id:n.type_id,type_name:n.type_name,latest_value:null,unit:n.unit||"mm"})}R.value=e}catch(a){console.error("加载仪器列表失败:",a)}},pe=async()=>{try{const a=await D({limit:10});ke.value=a,fe.data=a.map(e=>[e.measure_time,e.type_name,e.instrument_id,`${e.value.toFixed(2)} ${e.unit}`])}catch(a){console.error("加载最新数据失败:",a)}},Oe=async a=>{try{const e=R.value.find(i=>i.instrument_id===a);if(!e)return;const n=await D({instrument_id:e.instrument_id,limit:20});W.value=n,me.data=n.slice(0,5).map((i,_)=>({name:`测量${_+1}`,value:i.value.toFixed(2)})),await Ae(),ge(e.instrument_id)}catch(e){console.error("加载测点数据失败:",e),W.value=[],me.data=[];const n=R.value.find(i=>i.instrument_id===a);n&&(await Ae(),ge(n.instrument_id))}},ge=a=>{X.value&&(M&&M.dispose(),M=H(X.value),xe(a)),Z.value&&(T&&T.dispose(),T=H(Z.value),Ue(a))},Ue=async a=>{if(T)try{const e=["2018","2019","2020","2021","2022","2023","2024"],n={};e.forEach(s=>{n[s]=0});for(const s of e)try{const u=`${s}-01-01 00:00:00`,o=`${s}-12-31 23:59:59`,c=await D({instrument_id:a,start_time:u,end_time:o,limit:1e3});n[s]=c.length}catch(u){console.error(`获取${s}年数据失败:`,u),n[s]=0}const i=e.map(s=>n[s]),_=Math.max(...i);let d=100;_>0&&(_>100?d=Math.ceil(_*1.2):d=Math.ceil(_*1.1)),T.setOption({title:{text:"仪器使用记录（2018-2024年）",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},tooltip:{trigger:"axis",formatter:s=>{const u=s[0].name,o=s[0].value;return`${u}: ${o} 条记录`}},xAxis:{type:"category",data:e.map(s=>`${s}年`),axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}}},yAxis:{type:"value",name:"记录数量",nameTextStyle:{color:"#a0cfff"},axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}},splitLine:{lineStyle:{color:"rgba(64, 158, 255, 0.1)"}},min:0,max:d},series:[{name:"使用记录",type:"bar",data:i,itemStyle:{color:new q(0,0,0,1,[{offset:0,color:"#F6BD16"},{offset:1,color:"#E86452"}])},label:{show:!0,position:"top",formatter:"{c}",color:"#fff"}}],grid:{left:"10%",right:"10%",bottom:"15%",top:"20%",containLabel:!0}})}catch(e){console.error("加载仪器使用记录失败:",e),T.setOption({title:{text:"仪器使用记录（2018-2024年）",subtext:"数据加载失败",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:[],axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"记录数量",nameTextStyle:{color:"#a0cfff"},min:0,max:100},series:[{name:"使用记录",type:"bar",data:[]}]})}},xe=async a=>{if(M)try{console.log("开始加载趋势数据，仪器ID:",a);const e=new Date("2024-12-31"),n=new Date("2024-12-31");$.value==="month"?n.setDate(n.getDate()-30):n.setFullYear(n.getFullYear()-1);const i=n.toISOString().replace("T"," ").substring(0,19),_=e.toISOString().replace("T"," ").substring(0,19);console.log("时间范围:",i,"到",_);const d=await D({instrument_id:a,start_time:i,end_time:_,limit:100});if(console.log("API返回数据:",d),!d||d.length===0){console.warn("API返回空数据，显示空图表"),M.setOption({title:{text:$.value==="month"?"最新一个月数据趋势":"最近一年数据趋势",subtext:"暂无数据",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:[],axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"测量值",nameTextStyle:{color:"#a0cfff"},min:0,max:100},series:[{name:"数据趋势",type:"line",data:[]}]});return}const s=[...d].sort((y,C)=>new Date(y.measure_time)-new Date(C.measure_time));console.log("排序后数据:",s);const u=s.map(y=>{const C=new Date(y.measure_time);return $.value==="month"?`${C.getMonth()+1}/${C.getDate()}`:`${C.getMonth()+1}月`}),o=s.map(y=>parseFloat(y.value.toFixed(2)));console.log("图表数据 - 时间:",u),console.log("图表数据 - 数值:",o);const c=o.filter(y=>!isNaN(y)),h=c.length>0?Math.min(...c):0,m=c.length>0?Math.max(...c):100;console.log("数据范围 - 最小值:",h,"最大值:",m);let b=0,S=100;if(c.length>0)if(h<0){const C=(m-h)*.1;b=Math.floor(h-C),S=Math.ceil(m+C)}else m<10?(b=0,S=Math.ceil(m*1.2)):m<100?(b=Math.floor(h*.8),S=Math.ceil(m*1.2)):(b=Math.floor(h*.9),S=Math.ceil(m*1.1));console.log("y轴范围 - 最小值:",b,"最大值:",S),M.setOption({title:{text:$.value==="month"?"最新一个月数据趋势":"最近一年数据趋势",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},tooltip:{trigger:"axis",formatter:y=>{var se;const C=y[0].name,ne=y[0].value,r=y[0].dataIndex;return`${((se=s[r])==null?void 0:se.measure_time)||C}: ${ne}`}},xAxis:{type:"category",data:u,axisLabel:{color:"#a0cfff",rotate:$.value==="month"?45:0},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}}},yAxis:{type:"value",name:"测量值",nameTextStyle:{color:"#a0cfff"},axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}},splitLine:{lineStyle:{color:"rgba(64, 158, 255, 0.1)"}},min:b,max:S},series:[{name:"数据趋势",type:"line",data:o,smooth:!0,itemStyle:{color:"#6F5EF9"},lineStyle:{width:2},areaStyle:{color:new q(0,0,0,1,[{offset:0,color:"rgba(111, 94, 249, 0.6)"},{offset:1,color:"rgba(111, 94, 249, 0.1)"}])}}],grid:{left:"10%",right:"10%",bottom:$.value==="month"?"20%":"15%",top:"20%",containLabel:!0}}),console.log("图表渲染完成")}catch(e){console.error("加载趋势数据失败:",e),M.setOption({title:{text:$.value==="month"?"最新一个月数据趋势":"最近一年数据趋势",subtext:"数据加载失败",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:[],axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"测量值",nameTextStyle:{color:"#a0cfff"},min:0,max:100},series:[{name:"数据趋势",type:"line",data:[]}]})}},Ge=a=>{ce.value=a.id,L.value=a,Oe(a.instrument_id),je(a)},We=()=>{K.value&&(x=new Cesium.Viewer(K.value,{animation:!1,timeline:!1,baseLayerPicker:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,fullscreenButton:!1,terrainProvider:new Cesium.EllipsoidTerrainProvider,imageryProvider:new Cesium.UrlTemplateImageryProvider({url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"})}),x.camera.setView({destination:Cesium.Cartesian3.fromDegrees(118.746,32.06,1e3),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-45),roll:0}}),be(),Ye())},be=()=>{if(!x)return;O&&(x.entities.remove(O),O=null);const a=Cesium.Cartesian3.fromDegrees(118.746,32.06,30);let e="/models/dam1.glb";N.value==="dam2"?e="/models/dam2.glb":N.value==="dam3"&&(e="/models/dam3.glb"),O=x.entities.add({position:a,model:{uri:e,scale:5,minimumPixelSize:128,maximumScale:100}}),x.zoomTo(O)},Ye=()=>{if(x){for(const a of Y.values())x.entities.remove(a);Y.clear()}},je=a=>{if(!x||!Y.has(a.id))return;const e=Y.get(a.id);x.flyTo(e,{duration:1.5,offset:new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-45),200)})},He=()=>{x&&x.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(118.746,32.06,1e3),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-45),roll:0},duration:1.5})},qe=()=>{I.value=!I.value,I.value?document.documentElement.requestFullscreen():document.exitFullscreen()},Ke=()=>{J.value&&(E=H(J.value),we()),Q.value&&(k=H(Q.value),Se())},we=async()=>{if(E)try{const a=parseInt(F.value),e=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],n={};e.forEach(o=>{n[o]={sum:0,count:0}});for(let o=1;o<=12;o++)try{const c=`${a}-${String(o).padStart(2,"0")}-01 00:00:00`,h=`${a}-${String(o).padStart(2,"0")}-31 23:59:59`,m=await D({type_id:3,instrument_id:"上游",start_time:c,end_time:h,limit:100});if(m.length>0){const b=`${o}月`;n[b].sum=m.reduce((S,y)=>S+y.value,0),n[b].count=m.length}}catch(c){console.error(`获取${a}年${o}月上游水位数据失败:`,c)}const i=e.map(o=>{if(n[o].count>0){const c=n[o].sum/n[o].count;return parseFloat(c.toFixed(2))}return null});if(!i.some(o=>o!==null)){E.setOption({title:{text:`上游水位变化 (${F.value})`,subtext:"暂无数据",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},min:130,max:150},series:[{name:"上游水位",type:"line",data:i,connectNulls:!0}]});return}const d=i.filter(o=>o!==null&&!isNaN(o)),s=d.length>0?Math.min(...d):130,u=d.length>0?Math.max(...d):150;E.setOption({title:{text:`上游水位变化 (${F.value})`,left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},tooltip:{trigger:"axis",formatter:o=>{const c=o[0].name,h=o[0].value;return h!==null?`${c}: ${h} m`:`${c}: 无数据`}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}},splitLine:{lineStyle:{color:"rgba(64, 158, 255, 0.1)"}},min:Math.floor(s*.95),max:Math.ceil(u*1.05)},series:[{name:"上游水位",type:"line",data:i,smooth:!0,itemStyle:{color:"#5B8FF9"},lineStyle:{width:3},areaStyle:{color:new q(0,0,0,1,[{offset:0,color:"rgba(91, 143, 249, 0.6)"},{offset:1,color:"rgba(91, 143, 249, 0.1)"}])},connectNulls:!0}],grid:{left:"10%",right:"10%",bottom:"15%",top:"20%",containLabel:!0}})}catch(a){console.error("加载上游水位数据失败:",a);const e=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];E.setOption({title:{text:`上游水位变化 (${F.value})`,subtext:"数据加载失败",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},min:130,max:150},series:[{name:"上游水位",type:"line",data:[]}]})}},Se=async()=>{if(k)try{const a=parseInt(V.value),e=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],n={};e.forEach(o=>{n[o]={sum:0,count:0}});for(let o=1;o<=12;o++)try{const c=`${a}-${String(o).padStart(2,"0")}-01 00:00:00`,h=`${a}-${String(o).padStart(2,"0")}-31 23:59:59`,m=await D({type_id:3,instrument_id:"下游",start_time:c,end_time:h,limit:100});if(m.length>0){const b=`${o}月`;n[b].sum=m.reduce((S,y)=>S+y.value,0),n[b].count=m.length}}catch(c){console.error(`获取${a}年${o}月下游水位数据失败:`,c)}const i=e.map(o=>{if(n[o].count>0){const c=n[o].sum/n[o].count;return parseFloat(c.toFixed(2))}return null});if(!i.some(o=>o!==null)){k.setOption({title:{text:`下游水位变化 (${V.value})`,subtext:"暂无数据",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},min:120,max:140},series:[{name:"下游水位",type:"line",data:i,connectNulls:!0}]});return}const d=i.filter(o=>o!==null&&!isNaN(o)),s=d.length>0?Math.min(...d):120,u=d.length>0?Math.max(...d):140;k.setOption({title:{text:`下游水位变化 (${V.value})`,left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},tooltip:{trigger:"axis",formatter:o=>{const c=o[0].name,h=o[0].value;return h!==null?`${c}: ${h} m`:`${c}: 无数据`}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}},splitLine:{lineStyle:{color:"rgba(64, 158, 255, 0.1)"}},min:Math.floor(s*.95),max:Math.ceil(u*1.05)},series:[{name:"下游水位",type:"line",data:i,smooth:!0,itemStyle:{color:"#E86452"},lineStyle:{width:3},areaStyle:{color:new q(0,0,0,1,[{offset:0,color:"rgba(232, 100, 82, 0.6)"},{offset:1,color:"rgba(232, 100, 82, 0.1)"}])},connectNulls:!0}],grid:{left:"10%",right:"10%",bottom:"15%",top:"20%",containLabel:!0}})}catch(a){console.error("加载下游水位数据失败:",a);const e=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];k.setOption({title:{text:`下游水位变化 (${V.value})`,subtext:"数据加载失败",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},min:120,max:140},series:[{name:"下游水位",type:"line",data:[]}]})}};$e([F,V],()=>{we(),Se()}),$e($,()=>{L.value&&M&&xe(L.value.instrument_id)});const Je=async()=>{if(L.value)try{const a=await D({instrument_id:L.value.instrument_id,limit:1e3}),i=[["测量时间","监测类型","仪器编号","测量值","单位","水位值"].join(","),...a.map(u=>[`"${u.measure_time}"`,`"${u.type_name}"`,`"${u.instrument_id}"`,u.value,`"${u.unit}"`,u.water_level||""].join(","))].join(`
`),_=new Blob([i],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),s=URL.createObjectURL(_);d.setAttribute("href",s),d.setAttribute("download",`${L.value.name}_${L.value.instrument_id}_数据.csv`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),j.success("数据导出成功")}catch(a){console.error("导出数据失败:",a),j.error("导出数据失败")}};return Qe(async()=>{try{z.value=await Xe()}catch(e){console.error("加载用户信息失败:",e);const n=localStorage.getItem("user_info");if(n)try{z.value=JSON.parse(n)}catch{z.value={username:"用户",role:"user"}}}ve();const a=setInterval(ve,1e3);await Promise.all([_e(),he(),ye(),pe()]),We(),Ke(),document.addEventListener("fullscreenchange",()=>{I.value=!!document.fullscreenElement}),Ze(()=>{clearInterval(a),x&&x.destroy(),E&&E.dispose(),k&&k.dispose(),T&&T.dispose(),monthlyTrendChart&&monthlyTrendChart.dispose(),document.removeEventListener("fullscreenchange",()=>{})})}),(a,e)=>{const n=p("el-avatar"),i=p("el-button"),_=p("dv-digital-flop"),d=p("dv-active-ring-chart"),s=p("el-option"),u=p("el-select"),o=p("dv-border-box-8"),c=p("el-radio-button"),h=p("el-radio-group"),m=p("el-table-column"),b=p("el-table"),S=p("dv-border-box-10"),y=p("dv-scroll-board"),C=p("dv-border-box-12"),ne=p("dv-border-box-13");return P(),U("div",{class:Te(["monitor-container",{fullscreen:I.value}])},[t("div",{ref_key:"viewerEl",ref:K,class:"cesium-viewer"},null,512),t("div",rt,[e[7]||(e[7]=t("div",{class:"title-section"},[t("h1",null,"智慧水利大坝安全监测平台"),t("p",{class:"subtitle"},"实时监测 · 三维可视化 · 数据分析")],-1)),t("div",ct,[t("div",dt,[l(n,{size:36,src:Fe.value},null,8,["src"]),t("div",ut,[t("div",mt,g(z.value.name||z.value.username),1),t("div",ft,g(z.value.role==="admin"?"管理员":"普通用户"),1)]),et(tt)?(P(),Le(i,{key:0,type:"primary",size:"small",onClick:Ne},{default:v(()=>[...e[5]||(e[5]=[w("后台管理",-1)])]),_:1})):Me("",!0),l(i,{size:"small",onClick:Re},{default:v(()=>[...e[6]||(e[6]=[w("退出",-1)])]),_:1})]),t("div",vt,[t("div",_t,g(de.value),1),t("div",ht,g(ue.value),1)])])]),l(o,{class:"floating-window left-window overview-window"},{default:v(()=>[t("div",yt,[e[9]||(e[9]=t("h3",null,[t("i",{class:"el-icon-monitor"}),w(" 监测概览")],-1)),t("div",pt,[l(i,{size:"small",onClick:Ie},{default:v(()=>[...e[8]||(e[8]=[t("i",{class:"el-icon-refresh"},null,-1),w(" 刷新 ",-1)])]),_:1})])]),t("div",gt,[t("div",xt,[t("div",bt,[l(_,{config:ee},null,8,["config"]),e[10]||(e[10]=t("div",{class:"stat-label"},"总测量记录",-1))]),t("div",wt,[l(_,{config:te},null,8,["config"]),e[11]||(e[11]=t("div",{class:"stat-label"},"监测仪器",-1))]),t("div",St,[l(_,{config:ae},null,8,["config"]),e[12]||(e[12]=t("div",{class:"stat-label"},"监测类型",-1))]),t("div",Ct,[l(_,{config:Be},null,8,["config"]),e[13]||(e[13]=t("div",{class:"stat-label"},"数据时间范围",-1))])]),t("div",$t,[e[14]||(e[14]=t("h4",null,"监测类型分布",-1)),l(d,{config:oe,class:"chart-container"},null,8,["config"])]),t("div",Lt,[t("div",Mt,[t("div",Tt,[e[15]||(e[15]=t("h4",null,"上游水位变化趋势",-1)),t("div",Dt,[l(u,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=r=>F.value=r),placeholder:"年份",size:"small",style:{width:"100px"}},{default:v(()=>[l(s,{label:"2018",value:"2018"}),l(s,{label:"2019",value:"2019"}),l(s,{label:"2020",value:"2020"}),l(s,{label:"2021",value:"2021"}),l(s,{label:"2022",value:"2022"}),l(s,{label:"2023",value:"2023"}),l(s,{label:"2024",value:"2024"})]),_:1},8,["modelValue"])])]),t("div",{ref_key:"upstreamChartEl",ref:J,class:"chart-container"},null,512)]),t("div",zt,[t("div",At,[e[16]||(e[16]=t("h4",null,"下游水位变化趋势",-1)),t("div",Ft,[l(u,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=r=>V.value=r),placeholder:"年份",size:"small",style:{width:"100px"}},{default:v(()=>[l(s,{label:"2018",value:"2018"}),l(s,{label:"2019",value:"2019"}),l(s,{label:"2020",value:"2020"}),l(s,{label:"2021",value:"2021"}),l(s,{label:"2022",value:"2022"}),l(s,{label:"2023",value:"2023"}),l(s,{label:"2024",value:"2024"})]),_:1},8,["modelValue"])])]),t("div",{ref_key:"downstreamChartEl",ref:Q,class:"chart-container"},null,512)])])])]),_:1}),l(S,{class:"floating-window right-window points-window"},{default:v(()=>[t("div",Vt,[e[17]||(e[17]=t("h3",null,[t("i",{class:"el-icon-location-information"}),w(" 测点数据")],-1)),t("div",Et,[l(u,{modelValue:G.value,"onUpdate:modelValue":e[2]||(e[2]=r=>G.value=r),placeholder:"类型筛选",size:"mini",style:{width:"100px"}},{default:v(()=>[l(s,{label:"全部",value:"all"}),(P(!0),U(De,null,ze(re.value,r=>(P(),Le(s,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",kt,[t("div",Bt,[(P(!0),U(De,null,ze(Pe.value,r=>{var le;return P(),U("div",{key:r.id,class:Te(["point-item",{active:ce.value===r.id}]),onClick:se=>Ge(r)},[t("div",Nt,[t("div",Rt,g(r.name),1),t("div",It,[t("span",Ot,g(r.type_name),1),t("span",Ut,"仪器: "+g(r.instrument_id),1)])]),t("div",Gt,[t("div",Wt,g(((le=r.latest_value)==null?void 0:le.toFixed(2))||"--"),1),t("div",Yt,g(r.unit||""),1)])],10,Pt)}),128))]),L.value?(P(),U("div",jt,[t("div",Ht,[t("div",qt,[e[20]||(e[20]=t("h4",null,"最新数据趋势",-1)),t("div",Kt,[l(h,{modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=r=>$.value=r),size:"mini"},{default:v(()=>[l(c,{label:"month"},{default:v(()=>[...e[18]||(e[18]=[w("一个月",-1)])]),_:1}),l(c,{label:"year"},{default:v(()=>[...e[19]||(e[19]=[w("一年",-1)])]),_:1})]),_:1},8,["modelValue"])])]),t("div",{ref_key:"trendChartEl",ref:X,class:"chart-container",style:{height:"200px"}},null,512)]),t("div",Jt,[e[21]||(e[21]=t("div",{class:"chart-header"},[t("h4",null,"仪器使用记录（2018-2024年）")],-1)),t("div",{ref_key:"usageChartEl",ref:Z,class:"chart-container",style:{height:"200px"}},null,512)]),t("div",Qt,[t("div",Xt,[e[23]||(e[23]=t("h4",null,"历史数据",-1)),t("div",Zt,[l(i,{size:"mini",onClick:Je,type:"primary"},{default:v(()=>[...e[22]||(e[22]=[t("i",{class:"el-icon-download"},null,-1),w(" 导出CSV ",-1)])]),_:1})])]),t("div",ea,[l(b,{data:W.value,size:"mini",height:"200"},{default:v(()=>[l(m,{prop:"measure_time",label:"测量时间",width:"150"}),l(m,{prop:"type_name",label:"监测类型",width:"100"}),l(m,{prop:"instrument_id",label:"仪器编号",width:"100"}),l(m,{prop:"value",label:"测量值",width:"100"},{default:v(({row:r})=>[w(g(r.value.toFixed(2))+" "+g(r.unit),1)]),_:1}),l(m,{prop:"water_level",label:"水位值",width:"100"},{default:v(({row:r})=>[w(g(r.water_level?r.water_level.toFixed(2):"--"),1)]),_:1})]),_:1},8,["data"]),t("div",ta," 共 "+g(W.value.length)+" 条记录，显示最近20条 ",1)])])])):Me("",!0)])]),_:1}),l(C,{class:"floating-window bottom-window latest-data-window"},{default:v(()=>[e[24]||(e[24]=t("div",{class:"window-header"},[t("h3",null,[t("i",{class:"el-icon-s-data"}),w(" 最新监测数据")])],-1)),t("div",aa,[t("div",oa,[l(y,{config:fe},null,8,["config"])])])]),_:1}),l(ne,{class:"floating-window model-control-window"},{default:v(()=>[e[29]||(e[29]=t("div",{class:"window-header"},[t("h3",null,[t("i",{class:"el-icon-map-location"}),w(" 模型控制")])],-1)),t("div",na,[t("div",la,[l(u,{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=r=>N.value=r),placeholder:"选择模型",size:"mini",onChange:be},{default:v(()=>[l(s,{label:"大坝模型1 (dam1.glb)",value:"dam1"}),l(s,{label:"大坝模型2 (dam2.glb)",value:"dam2"}),l(s,{label:"大坝模型3 (dam3.glb)",value:"dam3"})]),_:1},8,["modelValue"]),l(i,{size:"mini",onClick:He},{default:v(()=>[...e[25]||(e[25]=[w("重置视角",-1)])]),_:1}),l(i,{size:"mini",onClick:qe},{default:v(()=>[...e[26]||(e[26]=[t("i",{class:"el-icon-full-screen"},null,-1),w(" 全屏 ",-1)])]),_:1})]),t("div",sa,[t("div",ia,[e[27]||(e[27]=t("span",{class:"label"},"当前模型：",-1)),t("span",ra,g(Ve[N.value]),1)]),t("div",ca,[e[28]||(e[28]=t("span",{class:"label"},"模型格式：",-1)),t("span",da,g(Ee[N.value]),1)])])])]),_:1})],2)}}},ha=it(ua,[["__scopeId","data-v-cd1b3f17"]]);export{ha as default};
