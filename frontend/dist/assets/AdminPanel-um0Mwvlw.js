import{r as h,m as Qe,a as R,n as Xe,p as Ze,q as et,H as tt,s as lt,c as F,b as l,d as t,e as _,x as I,w as s,v as j,B as st,I as at,t as J,J as ce,E as c,u as nt,o as z,j as o,F as oe,D as re,K as ot,L as rt,G as it}from"./index-CSIV7qOm.js";import{g as dt,a as fe,i as _e,c as ge,L as ut,d as mt,e as ye,u as pt,b as vt}from"./monitoring_new-VB7aKBvM.js";import{_ as ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ft={class:"admin-container"},_t={class:"admin-header"},gt={class:"header-right"},yt={class:"user-info"},bt={class:"user-details"},wt={class:"username"},ht={class:"admin-content"},Ct={class:"admin-sidebar"},Vt={class:"admin-main"},zt={key:0,class:"dashboard-panel"},kt={class:"stats-grid"},St={class:"stat-content"},$t={class:"stat-details"},Ut={class:"stat-value"},xt={class:"stat-content"},Dt={class:"stat-details"},Mt={class:"stat-value"},Ft={class:"stat-content"},It={class:"stat-details"},Yt={class:"stat-value"},At={class:"stat-content"},Et={class:"stat-details"},qt={class:"stat-value"},Lt={class:"charts-row"},Rt={class:"chart-card"},Bt={class:"chart-card"},Tt={class:"chart-header"},Ot={class:"chart-title-controls"},jt={class:"chart-filters"},Nt={key:1,class:"measurements-panel"},Pt={class:"panel-header"},Ht={class:"panel-controls"},Gt={class:"filter-bar"},Kt={class:"pagination"},Jt={key:2,class:"instruments-panel"},Wt={class:"panel-header"},Qt={class:"panel-controls"},Xt={key:3,class:"users-panel"},Zt={class:"panel-header"},el={class:"panel-controls"},tl={key:0,class:"import-preview"},ll={__name:"AdminPanel",setup(sl){const ie=nt(),B=h({}),be=Qe(()=>`https://api.dicebear.com/7.x/avataaars/svg?seed=${B.value.username||"admin"}`),Y=h("dashboard"),T=h({totalMeasurements:0,instrumentCount:0,userCount:0,lastUpdate:"--"}),de=h([]),W=h([]),Q=h([]),X=h(!1),p=R({type_id:null,instrument_id:null,dateRange:null,start_time:null,end_time:null}),C=R({current:1,size:50,total:0}),A=R({visible:!1,loading:!1}),E=h([]),N=h([]),ue=h([]),k=R({visible:!1,title:"新增用户",loading:!1,mode:"add",editingId:null}),b=R({username:"",password:"",name:"",email:"",role:"user"}),we={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},Z=h(),M=h("2024"),ee=h("all"),y=R({visible:!1,title:"新增测量记录",loading:!1,mode:"add",editingId:null});Xe([M,ee],()=>{me()});const g=R({type_id:null,instrument_id:"",measure_time:"",value:0,water_level:null}),he={type_id:[{required:!0,message:"请选择监测类型",trigger:"change"}],instrument_id:[{required:!0,message:"请输入仪器编号",trigger:"blur"}],measure_time:[{required:!0,message:"请选择测量时间",trigger:"change"}],value:[{required:!0,message:"请输入测量值",trigger:"blur"}]},te=h(),P=h(null),H=h(null);let x=null,$=null;const Ce=a=>{Y.value=a,a==="dashboard"?le():a==="measurements"?(D(),Se(),se()):a==="instruments"?se():a==="users"&&G()},Ve=()=>{ie.push("/monitor")},ze=async()=>{try{await it(),ie.push("/login")}catch(a){console.error("登出失败:",a)}},le=async()=>{try{const[a,e,u]=await Promise.all([dt(),fe(),ce()]);T.value={totalMeasurements:a.total_measurements||0,instrumentCount:a.instrument_count||0,userCount:u.length||0,lastUpdate:new Date().toLocaleTimeString("zh-CN")},ke(a.type_statistics||[]),await me()}catch(a){console.error("加载仪表板数据失败:",a),c.error("加载数据失败")}},ke=a=>{if(!P.value)return;x&&x.dispose(),x=_e(P.value);const e=a.map(u=>({name:u.name,value:u.count}));x.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:e.map(u=>u.name)},series:[{name:"监测类型",type:"pie",radius:["40%","70%"],center:["35%","50%"],itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},data:e}]})},me=async()=>{if(H.value){$&&$.dispose(),$=_e(H.value);try{const a={limit:1e4};if(ee.value!=="all"&&(a.type_id=ee.value),M.value!=="all"){const v=M.value;a.start_time=`${v}-01-01 00:00:00`,a.end_time=`${v}-12-31 23:59:59`}const e=await ge(a),u={};for(let v=1;v<=12;v++){const m=`${String(v).padStart(2,"0")}`;u[m]=0}e.forEach(v=>{const m=new Date(v.measure_time),d=String(m.getMonth()+1).padStart(2,"0");u[d]=(u[d]||0)+1});const r=[],f=[];for(let v=1;v<=12;v++){const m=`${String(v).padStart(2,"0")}`;r.push(`${v}月`),f.push(u[m])}const U=`采集数据量${M.value!=="all"?` (${M.value})`:""}`;$.setOption({title:{text:U,left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:function(v){const m=v[0].axisValue,d=v[0].data;return`${m}<br/>数据量: ${d} 条`}},xAxis:{type:"category",data:r,axisLabel:{rotate:45}},yAxis:{type:"value",name:"数据量 (条)"},series:[{name:"数据量",type:"line",data:f,smooth:!0,itemStyle:{color:"#5B8FF9"},areaStyle:{color:new ut(0,0,0,1,[{offset:0,color:"rgba(91, 143, 249, 0.6)"},{offset:1,color:"rgba(91, 143, 249, 0.1)"}])}}],grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0}})}catch(a){console.error("渲染增长图表失败:",a),$.setOption({title:{text:`采集数据量${M.value!=="all"?` (${M.value})`:""}`,left:"center"},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{name:"数据量",type:"line",data:[],itemStyle:{color:"#5B8FF9"}}]})}}},D=async()=>{X.value=!0;try{const a={limit:C.size,offset:(C.current-1)*C.size};p.type_id&&(a.type_id=p.type_id),p.instrument_id&&(a.instrument_id=p.instrument_id),p.start_time&&(a.start_time=p.start_time),p.end_time&&(a.end_time=p.end_time);const e=await ge(a);de.value=e,C.total=1e3}catch(a){console.error("加载测量数据失败:",a),c.error("加载数据失败")}finally{X.value=!1}},Se=async()=>{try{W.value=await fe()}catch(a){console.error("加载监测类型失败:",a)}},se=async()=>{try{Q.value=await vt()}catch(a){console.error("加载仪器列表失败:",a)}},G=async()=>{try{ue.value=await ce()}catch(a){console.error("加载用户列表失败:",a)}},$e=()=>{D()},Ue=()=>{se()},xe=()=>{C.current=1,D()},De=()=>{p.type_id=null,p.instrument_id=null,C.current=1,D()},Me=a=>{C.size=a,C.current=1,D()},Fe=a=>{C.current=a,D()},Ie=a=>{a&&a.length===2?(p.start_time=`${a[0]} 00:00:00`,p.end_time=`${a[1]} 23:59:59`):(p.start_time=null,p.end_time=null)},Ye=()=>{y.mode="add",y.title="新增测量记录",y.editingId=null,Object.assign(g,{type_id:null,instrument_id:"",measure_time:"",value:0,water_level:null}),y.visible=!0},Ae=a=>{y.mode="edit",y.title="编辑测量记录",y.editingId=a.id,Object.assign(g,{type_id:a.type_id,instrument_id:a.instrument_id,measure_time:a.measure_time,value:a.value,water_level:a.water_level}),y.visible=!0},Ee=async()=>{var a,e;if(te.value)try{await te.value.validate(),y.loading=!0;const u={type_id:g.type_id,instrument_id:g.instrument_id,measure_time:g.measure_time,value:g.value};g.water_level!==null&&(u.water_level=g.water_level),y.mode==="add"?(await ye(u),c.success("新增成功")):(await pt(y.editingId,u),c.success("更新成功")),y.visible=!1,D()}catch(u){console.error("保存测量记录失败:",u),(e=(a=u.response)==null?void 0:a.data)!=null&&e.message?c.error(`保存失败: ${u.response.data.message}`):c.error("保存失败")}finally{y.loading=!1}},qe=async a=>{try{await mt(a),c.success("删除成功"),D()}catch(e){console.error("删除测量记录失败:",e),c.error("删除失败")}},Le=a=>{Y.value="measurements",p.instrument_id=a.instrument_id,p.type_id=a.type_id,D()},Re=()=>{x&&P.value&&x.resize(),$&&H.value&&$.resize()};Ze(async()=>{try{B.value=await et()}catch(a){console.error("加载用户信息失败:",a);const e=localStorage.getItem("user_info");if(e)try{B.value=JSON.parse(e)}catch{B.value={username:"管理员",role:"admin"}}}le(),window.addEventListener("resize",pe)}),tt(()=>{Re(),Y.value==="dashboard"&&le()});const pe=()=>{x&&x.resize(),$&&$.resize()},Be=()=>{G()},Te=()=>{k.mode="add",k.title="新增用户",k.editingId=null,Object.assign(b,{username:"",password:"",name:"",email:"",role:"user"}),k.visible=!0},Oe=async()=>{if(Z.value)try{await Z.value.validate(),k.loading=!0;const a={username:b.username,password:b.password,name:b.name,email:b.email,role:b.role};await rt(a),c.success("用户创建成功"),k.visible=!1,G()}catch(a){console.error("保存用户失败:",a),c.error(`保存失败: ${a.message}`)}finally{k.loading=!1}},je=async a=>{try{await ot(a),c.success("用户删除成功"),G()}catch(e){console.error("删除用户失败:",e),c.error(`删除失败: ${e.message}`)}},Ne=()=>{A.visible=!0,E.value=[],N.value=[]},Pe=a=>{const e=new FileReader;e.onload=u=>{try{const f=u.target.result.split(`
`);if(f.length===0){c.warning("CSV文件为空");return}const U=f[0].split(",").map(V=>V.trim()),m=["type_id","instrument_id","measure_time","value"].filter(V=>!U.includes(V));if(m.length>0){c.error(`CSV文件缺少必需列: ${m.join(", ")}`);return}const d=[];for(let V=1;V<f.length;V++){const w=f[V].trim();if(!w)continue;const q=w.split(",").map(i=>i.trim()),S={};U.forEach((i,L)=>{L<q.length&&(i==="type_id"?S[i]=parseInt(q[L])||0:i==="value"||i==="water_level"?S[i]=parseFloat(q[L])||0:S[i]=q[L])}),S.type_id&&S.instrument_id&&S.measure_time&&S.value!==void 0&&d.push(S)}if(d.length===0){c.warning("CSV文件中没有有效数据");return}E.value=d,N.value=d.slice(0,5),c.success(`成功解析 ${d.length} 条数据`)}catch(r){console.error("解析CSV文件失败:",r),c.error("解析CSV文件失败，请检查文件格式")}},e.readAsText(a.raw)},He=async()=>{if(E.value.length===0){c.warning("没有数据可导入");return}A.loading=!0;try{let a=0,e=0;const u=50;for(let r=0;r<E.value.length;r+=u){const U=E.value.slice(r,r+u).map(async m=>{try{const d={type_id:m.type_id,instrument_id:m.instrument_id,measure_time:m.measure_time,value:m.value};m.water_level!==void 0&&(d.water_level=m.water_level),await ye(d),a++}catch(d){console.error("导入数据失败:",m,d),e++}});await Promise.all(U);const v=Math.min(r+u,E.value.length);console.log(`导入进度: ${v}/${E.value.length}`)}e===0?c.success(`成功导入 ${a} 条数据`):c.warning(`导入完成: ${a} 条成功, ${e} 条失败`),A.visible=!1,D()}catch(a){console.error("导入数据失败:",a),c.error("导入数据失败")}finally{A.loading=!1}};return lt(()=>{window.removeEventListener("resize",pe),x&&x.dispose(),$&&$.dispose()}),(a,e)=>{const u=_("el-avatar"),r=_("el-button"),f=_("el-icon"),U=_("el-menu-item"),v=_("el-menu"),m=_("dv-border-box-8"),d=_("el-option"),V=_("el-select"),w=_("el-form-item"),q=_("el-date-picker"),S=_("el-form"),i=_("el-table-column"),L=_("el-popconfirm"),K=_("el-table"),Ge=_("el-pagination"),Ke=_("el-tag"),O=_("el-input"),ve=_("el-input-number"),ae=_("el-dialog"),Je=_("el-upload"),We=at("loading");return z(),F("div",ft,[l("div",_t,[e[25]||(e[25]=l("div",{class:"header-left"},[l("h1",null,"后台管理系统"),l("p",{class:"subtitle"},"管理员专用 · 数据管理 · 系统配置")],-1)),l("div",gt,[l("div",yt,[t(u,{size:36,src:be.value},null,8,["src"]),l("div",bt,[l("div",wt,I(B.value.name||B.value.username),1),e[22]||(e[22]=l("div",{class:"user-role"},"管理员",-1))]),t(r,{type:"primary",size:"small",onClick:Ve},{default:s(()=>[...e[23]||(e[23]=[o("返回监控",-1)])]),_:1}),t(r,{size:"small",onClick:ze},{default:s(()=>[...e[24]||(e[24]=[o("退出",-1)])]),_:1})])])]),l("div",ht,[l("div",Ct,[t(v,{"default-active":Y.value,class:"admin-menu",onSelect:Ce},{default:s(()=>[t(U,{index:"dashboard"},{default:s(()=>[t(f,null,{default:s(()=>[...e[26]||(e[26]=[l("i",{class:"el-icon-data-board"},null,-1)])]),_:1}),e[27]||(e[27]=l("span",null,"数据概览",-1))]),_:1}),t(U,{index:"measurements"},{default:s(()=>[t(f,null,{default:s(()=>[...e[28]||(e[28]=[l("i",{class:"el-icon-s-data"},null,-1)])]),_:1}),e[29]||(e[29]=l("span",null,"测量数据管理",-1))]),_:1}),t(U,{index:"instruments"},{default:s(()=>[t(f,null,{default:s(()=>[...e[30]||(e[30]=[l("i",{class:"el-icon-monitor"},null,-1)])]),_:1}),e[31]||(e[31]=l("span",null,"仪器管理",-1))]),_:1}),t(U,{index:"users"},{default:s(()=>[t(f,null,{default:s(()=>[...e[32]||(e[32]=[l("i",{class:"el-icon-user"},null,-1)])]),_:1}),e[33]||(e[33]=l("span",null,"用户管理",-1))]),_:1})]),_:1},8,["default-active"])]),l("div",Vt,[Y.value==="dashboard"?(z(),F("div",zt,[l("div",kt,[t(m,{class:"stat-card"},{default:s(()=>{var n;return[l("div",St,[e[35]||(e[35]=l("div",{class:"stat-icon",style:{color:"#5B8FF9"}},[l("i",{class:"el-icon-data-line"})],-1)),l("div",$t,[l("div",Ut,I(((n=T.value.totalMeasurements)==null?void 0:n.toLocaleString())||"0"),1),e[34]||(e[34]=l("div",{class:"stat-label"},"总测量记录",-1))])])]}),_:1}),t(m,{class:"stat-card"},{default:s(()=>[l("div",xt,[e[37]||(e[37]=l("div",{class:"stat-icon",style:{color:"#5AD8A6"}},[l("i",{class:"el-icon-monitor"})],-1)),l("div",Dt,[l("div",Mt,I(T.value.instrumentCount||"0"),1),e[36]||(e[36]=l("div",{class:"stat-label"},"监测仪器",-1))])])]),_:1}),t(m,{class:"stat-card"},{default:s(()=>[l("div",Ft,[e[39]||(e[39]=l("div",{class:"stat-icon",style:{color:"#F6BD16"}},[l("i",{class:"el-icon-user"})],-1)),l("div",It,[l("div",Yt,I(T.value.userCount||"0"),1),e[38]||(e[38]=l("div",{class:"stat-label"},"系统用户",-1))])])]),_:1}),t(m,{class:"stat-card"},{default:s(()=>[l("div",At,[e[41]||(e[41]=l("div",{class:"stat-icon",style:{color:"#6F5EF9"}},[l("i",{class:"el-icon-alarm-clock"})],-1)),l("div",Et,[l("div",qt,I(T.value.lastUpdate||"--"),1),e[40]||(e[40]=l("div",{class:"stat-label"},"最后更新",-1))])])]),_:1})]),l("div",Lt,[l("div",Rt,[e[42]||(e[42]=l("div",{class:"chart-header"},[l("h3",null,"监测类型分布")],-1)),l("div",{ref_key:"typeChartEl",ref:P,class:"chart-container"},null,512)]),l("div",Bt,[l("div",Tt,[l("div",Ot,[e[43]||(e[43]=l("h3",null,"采集数据量",-1)),l("div",jt,[t(V,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=n=>M.value=n),placeholder:"年份",size:"small",style:{width:"100px"}},{default:s(()=>[t(d,{label:"2018",value:"2018"}),t(d,{label:"2019",value:"2019"}),t(d,{label:"2020",value:"2020"}),t(d,{label:"2021",value:"2021"}),t(d,{label:"2022",value:"2022"}),t(d,{label:"2023",value:"2023"}),t(d,{label:"2024",value:"2024"})]),_:1},8,["modelValue"])])])]),l("div",{ref_key:"growthChartEl",ref:H,class:"chart-container"},null,512)])])])):j("",!0),Y.value==="measurements"?(z(),F("div",Nt,[l("div",Pt,[e[50]||(e[50]=l("h2",null,"测量数据管理",-1)),l("div",Ht,[t(r,{type:"primary",size:"small",onClick:Ye},{default:s(()=>[t(f,null,{default:s(()=>[...e[44]||(e[44]=[l("i",{class:"el-icon-plus"},null,-1)])]),_:1}),e[45]||(e[45]=o(" 新增记录 ",-1))]),_:1}),t(r,{type:"success",size:"small",onClick:Ne},{default:s(()=>[t(f,null,{default:s(()=>[...e[46]||(e[46]=[l("i",{class:"el-icon-upload"},null,-1)])]),_:1}),e[47]||(e[47]=o(" CSV导入 ",-1))]),_:1}),t(r,{size:"small",onClick:$e},{default:s(()=>[t(f,null,{default:s(()=>[...e[48]||(e[48]=[l("i",{class:"el-icon-refresh"},null,-1)])]),_:1}),e[49]||(e[49]=o(" 刷新 ",-1))]),_:1})])]),l("div",Gt,[t(S,{inline:!0,size:"small"},{default:s(()=>[t(w,{label:"监测类型"},{default:s(()=>[t(V,{modelValue:p.type_id,"onUpdate:modelValue":e[1]||(e[1]=n=>p.type_id=n),placeholder:"全部类型",clearable:""},{default:s(()=>[(z(!0),F(oe,null,re(W.value,n=>(z(),J(d,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"仪器编号"},{default:s(()=>[t(V,{modelValue:p.instrument_id,"onUpdate:modelValue":e[2]||(e[2]=n=>p.instrument_id=n),placeholder:"全部仪器",clearable:"",filterable:""},{default:s(()=>[(z(!0),F(oe,null,re(Q.value,n=>(z(),J(d,{key:n.instrument_id,label:`${n.instrument_id} (${n.type_name})`,value:n.instrument_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"时间范围"},{default:s(()=>[t(q,{modelValue:p.dateRange,"onUpdate:modelValue":e[3]||(e[3]=n=>p.dateRange=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",clearable:!0,onChange:Ie},null,8,["modelValue"])]),_:1}),t(w,null,{default:s(()=>[t(r,{type:"primary",onClick:xe},{default:s(()=>[...e[51]||(e[51]=[o("查询",-1)])]),_:1}),t(r,{onClick:De},{default:s(()=>[...e[52]||(e[52]=[o("重置",-1)])]),_:1})]),_:1})]),_:1})]),st((z(),J(K,{data:de.value,height:"500",style:{width:"100%"},size:"small"},{default:s(()=>[t(i,{prop:"id",label:"ID",width:"80"}),t(i,{prop:"type_name",label:"监测类型",width:"120"}),t(i,{prop:"instrument_id",label:"仪器编号",width:"120"}),t(i,{prop:"measure_time",label:"测量时间",width:"180"}),t(i,{prop:"value",label:"测量值",width:"120"},{default:s(({row:n})=>[o(I(n.value.toFixed(2))+" "+I(n.unit),1)]),_:1}),t(i,{prop:"water_level",label:"水位值",width:"120"},{default:s(({row:n})=>[o(I(n.water_level?n.water_level.toFixed(2):"--"),1)]),_:1}),t(i,{label:"操作",width:"200",fixed:"right"},{default:s(({row:n})=>[t(r,{size:"small",onClick:ne=>Ae(n)},{default:s(()=>[...e[53]||(e[53]=[o("编辑",-1)])]),_:1},8,["onClick"]),t(L,{title:"确定删除这条记录吗？",onConfirm:ne=>qe(n.id)},{reference:s(()=>[t(r,{size:"small",type:"danger"},{default:s(()=>[...e[54]||(e[54]=[o("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[We,X.value]]),l("div",Kt,[t(Ge,{"current-page":C.current,"onUpdate:currentPage":e[4]||(e[4]=n=>C.current=n),"page-size":C.size,"onUpdate:pageSize":e[5]||(e[5]=n=>C.size=n),total:C.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Me,onCurrentChange:Fe},null,8,["current-page","page-size","total"])])])):j("",!0),Y.value==="instruments"?(z(),F("div",Jt,[l("div",Wt,[e[57]||(e[57]=l("h2",null,"仪器管理",-1)),l("div",Qt,[t(r,{size:"small",onClick:Ue},{default:s(()=>[t(f,null,{default:s(()=>[...e[55]||(e[55]=[l("i",{class:"el-icon-refresh"},null,-1)])]),_:1}),e[56]||(e[56]=o(" 刷新 ",-1))]),_:1})])]),t(K,{data:Q.value,height:"600",style:{width:"100%"},size:"small"},{default:s(()=>[t(i,{prop:"instrument_id",label:"仪器编号",width:"150"}),t(i,{prop:"type_name",label:"监测类型",width:"150"}),t(i,{label:"操作",width:"150",fixed:"right"},{default:s(({row:n})=>[t(r,{size:"small",onClick:ne=>Le(n)},{default:s(()=>[...e[58]||(e[58]=[o("查看数据",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):j("",!0),Y.value==="users"?(z(),F("div",Xt,[l("div",Zt,[e[63]||(e[63]=l("h2",null,"用户管理",-1)),l("div",el,[t(r,{type:"primary",size:"small",onClick:Te},{default:s(()=>[t(f,null,{default:s(()=>[...e[59]||(e[59]=[l("i",{class:"el-icon-plus"},null,-1)])]),_:1}),e[60]||(e[60]=o(" 新增用户 ",-1))]),_:1}),t(r,{size:"small",onClick:Be},{default:s(()=>[t(f,null,{default:s(()=>[...e[61]||(e[61]=[l("i",{class:"el-icon-refresh"},null,-1)])]),_:1}),e[62]||(e[62]=o(" 刷新 ",-1))]),_:1})])]),t(K,{data:ue.value,height:"600",style:{width:"100%"},size:"small"},{default:s(()=>[t(i,{prop:"username",label:"用户名",width:"150"}),t(i,{prop:"name",label:"姓名",width:"150"}),t(i,{prop:"email",label:"邮箱",width:"200"}),t(i,{prop:"role",label:"角色",width:"120"},{default:s(({row:n})=>[t(Ke,{type:n.role==="admin"?"danger":"success",size:"small"},{default:s(()=>[o(I(n.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),t(i,{label:"操作",width:"200",fixed:"right"},{default:s(({row:n})=>[t(L,{title:"确定删除这个用户吗？",onConfirm:ne=>je(n.id)},{reference:s(()=>[t(r,{size:"small",type:"danger"},{default:s(()=>[...e[64]||(e[64]=[o("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])])):j("",!0)])]),t(ae,{modelValue:y.visible,"onUpdate:modelValue":e[12]||(e[12]=n=>y.visible=n),title:y.title,width:"500px"},{footer:s(()=>[t(r,{onClick:e[11]||(e[11]=n=>y.visible=!1)},{default:s(()=>[...e[65]||(e[65]=[o("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:Ee,loading:y.loading},{default:s(()=>[...e[66]||(e[66]=[o(" 保存 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[t(S,{model:g,rules:he,ref_key:"measurementFormRef",ref:te,"label-width":"100px"},{default:s(()=>[t(w,{label:"监测类型",prop:"type_id"},{default:s(()=>[t(V,{modelValue:g.type_id,"onUpdate:modelValue":e[6]||(e[6]=n=>g.type_id=n),placeholder:"请选择监测类型",style:{width:"100%"}},{default:s(()=>[(z(!0),F(oe,null,re(W.value,n=>(z(),J(d,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"仪器编号",prop:"instrument_id"},{default:s(()=>[t(O,{modelValue:g.instrument_id,"onUpdate:modelValue":e[7]||(e[7]=n=>g.instrument_id=n),placeholder:"请输入仪器编号"},null,8,["modelValue"])]),_:1}),t(w,{label:"测量时间",prop:"measure_time"},{default:s(()=>[t(q,{modelValue:g.measure_time,"onUpdate:modelValue":e[8]||(e[8]=n=>g.measure_time=n),type:"datetime",placeholder:"选择测量时间",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(w,{label:"测量值",prop:"value"},{default:s(()=>[t(ve,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=n=>g.value=n),precision:2,step:.01,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(w,{label:"水位值"},{default:s(()=>[t(ve,{modelValue:g.water_level,"onUpdate:modelValue":e[10]||(e[10]=n=>g.water_level=n),precision:2,step:.01,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(ae,{modelValue:k.visible,"onUpdate:modelValue":e[19]||(e[19]=n=>k.visible=n),title:k.title,width:"500px"},{footer:s(()=>[t(r,{onClick:e[18]||(e[18]=n=>k.visible=!1)},{default:s(()=>[...e[67]||(e[67]=[o("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:Oe,loading:k.loading},{default:s(()=>[...e[68]||(e[68]=[o(" 保存 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[t(S,{model:b,rules:we,ref_key:"userFormRef",ref:Z,"label-width":"100px"},{default:s(()=>[t(w,{label:"用户名",prop:"username"},{default:s(()=>[t(O,{modelValue:b.username,"onUpdate:modelValue":e[13]||(e[13]=n=>b.username=n),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(w,{label:"密码",prop:"password"},{default:s(()=>[t(O,{modelValue:b.password,"onUpdate:modelValue":e[14]||(e[14]=n=>b.password=n),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(w,{label:"姓名",prop:"name"},{default:s(()=>[t(O,{modelValue:b.name,"onUpdate:modelValue":e[15]||(e[15]=n=>b.name=n),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),t(w,{label:"邮箱",prop:"email"},{default:s(()=>[t(O,{modelValue:b.email,"onUpdate:modelValue":e[16]||(e[16]=n=>b.email=n),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),t(w,{label:"角色",prop:"role"},{default:s(()=>[t(V,{modelValue:b.role,"onUpdate:modelValue":e[17]||(e[17]=n=>b.role=n),placeholder:"请选择角色",style:{width:"100%"}},{default:s(()=>[t(d,{label:"管理员",value:"admin"}),t(d,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(ae,{modelValue:A.visible,"onUpdate:modelValue":e[21]||(e[21]=n=>A.visible=n),title:"CSV数据导入",width:"600px"},{footer:s(()=>[t(r,{onClick:e[20]||(e[20]=n=>A.visible=!1)},{default:s(()=>[...e[73]||(e[73]=[o("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:He,loading:A.loading,disabled:E.value.length===0},{default:s(()=>[...e[74]||(e[74]=[o(" 导入数据 ",-1)])]),_:1},8,["loading","disabled"])]),default:s(()=>[e[75]||(e[75]=l("div",{class:"import-instructions"},[l("h4",null,"导入说明："),l("ul",null,[l("li",null,[o("CSV文件必须包含以下列："),l("code",null,"type_id"),o(", "),l("code",null,"instrument_id"),o(", "),l("code",null,"measure_time"),o(", "),l("code",null,"value")]),l("li",null,[l("code",null,"type_id"),o(": 监测类型ID（整数）")]),l("li",null,[l("code",null,"instrument_id"),o(': 仪器ID（字符串，如"上游"、"下游"）')]),l("li",null,[l("code",null,"measure_time"),o(": 测量时间（格式: YYYY-MM-DD HH:MM:SS）")]),l("li",null,[l("code",null,"value"),o(": 测量值（浮点数）")]),l("li",null,[o("可选列："),l("code",null,"water_level"),o("（水位值，浮点数）")])])],-1)),t(Je,{class:"csv-upload",drag:"",action:"#","auto-upload":!1,"on-change":Pe,"show-file-list":!0,accept:".csv"},{default:s(()=>[t(f,{class:"el-icon--upload"},{default:s(()=>[...e[69]||(e[69]=[l("i",{class:"el-icon-upload"},null,-1)])]),_:1}),e[70]||(e[70]=l("div",{class:"el-upload__text"},[o("将CSV文件拖到此处，或"),l("em",null,"点击上传")],-1)),e[71]||(e[71]=l("div",{class:"el-upload__tip",slot:"tip"},"只能上传CSV文件，且不超过10MB",-1))]),_:1}),N.value.length>0?(z(),F("div",tl,[e[72]||(e[72]=l("h4",null,"数据预览（前5行）：",-1)),t(K,{data:N.value,size:"small",height:"200"},{default:s(()=>[t(i,{prop:"type_id",label:"监测类型ID",width:"100"}),t(i,{prop:"instrument_id",label:"仪器编号",width:"120"}),t(i,{prop:"measure_time",label:"测量时间",width:"150"}),t(i,{prop:"value",label:"测量值",width:"100"}),t(i,{prop:"water_level",label:"水位值",width:"100"})]),_:1},8,["data"])])):j("",!0)]),_:1},8,["modelValue"])])}}},rl=ct(ll,[["__scopeId","data-v-a6abd19c"]]);export{rl as default};
