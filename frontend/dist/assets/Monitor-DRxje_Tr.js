import{r as d,m as Ae,a as P,n as Fe,p as lt,q as ot,s as nt,c as H,b as t,d as o,t as Ve,v as ke,e as x,x as _,f as st,y as it,w as f,z as L,u as rt,o as N,j as g,A as Q,B as X,F as Ee,C as Be,E as Z,D as Pe,G as ct}from"./index-B-e0xK3J.js";import{g as ut,a as dt,b as mt,c as z,i as ee,L as te}from"./monitoring_new-wJYZJIpQ.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";const vt={class:"top-bar"},_t={class:"user-section"},pt={class:"user-info"},ht={class:"user-details"},yt={class:"username"},gt={class:"user-role"},xt={class:"time-display"},bt={class:"current-time"},wt={class:"current-date"},St={class:"window-header"},Ct={class:"window-controls"},$t={class:"window-content"},Lt={class:"stats-grid"},Mt={class:"stat-item"},Tt={class:"stat-item"},Dt={class:"stat-item"},zt={class:"stat-item"},At={class:"monitoring-types"},Ft={class:"additional-charts"},Vt={class:"chart-section"},kt={class:"chart-header"},Et={class:"chart-controls"},Bt={class:"chart-section"},Pt={class:"chart-header"},Nt={class:"chart-controls"},Rt={class:"window-header"},It={class:"window-controls"},Ot={class:"window-content"},Ut={class:"points-list"},Gt=["onClick"],Wt={class:"point-info"},Yt={class:"point-name"},jt={class:"point-details"},Ht={class:"point-type"},qt={class:"point-instrument"},Kt={class:"point-value"},Jt={class:"value"},Qt={class:"unit"},Xt={key:0,class:"point-detail"},Zt={class:"dynamic-chart"},ea={class:"chart-header"},ta={class:"chart-controls"},aa={class:"dynamic-chart"},la={class:"historical-data-section"},oa={class:"section-header"},na={class:"section-controls"},sa={class:"measurements-table"},ia={class:"table-footer"},ra={class:"window-header"},ca={class:"window-controls"},ua={class:"window-content"},da={class:"scroll-board-container"},ma={class:"window-header"},fa={class:"window-controls"},va={class:"window-content"},_a={class:"model-controls"},pa={class:"model-info"},ha={class:"info-item"},ya={class:"value"},ga={class:"info-item"},xa={class:"value"},ba={__name:"Monitor",setup(wa){const ve=rt(),ae=d(null),A=d({}),Ne=Ae(()=>`https://api.dicebear.com/7.x/avataaars/svg?seed=${A.value.username||"user"}`),R=d("dam1"),Re={dam1:"大坝模型1",dam2:"大坝模型2",dam3:"大坝模型3"},Ie={dam1:"GLB格式",dam2:"GLB格式",dam3:"GLB格式"},F=d({}),_e=d([]),W=d([]),Oe=d([]),q=d("all"),pe=d(null),M=d(null),K=d([]),Y=d(!1),I=d(!1),O=d(!1),U=d(!1),G=d(!1),V=d("2024"),k=d("2024"),$=d("month"),le=d(null),oe=d(null),ne=d(null),se=d(null);let E=null,B=null,T=null,D=null;const he=d(""),ye=d(""),ie=P({number:[0],content:"{nt}",style:{fontSize:24,fill:"#fff",fontWeight:"bold"},formatter:a=>a.toLocaleString()}),re=P({number:[0],content:"{nt}",style:{fontSize:24,fill:"#fff",fontWeight:"bold"}}),ce=P({number:[0],content:"{nt}",style:{fontSize:24,fill:"#fff",fontWeight:"bold"}}),Ue=P({number:[0],content:"{nt}",style:{fontSize:18,fill:"#fff",fontWeight:"bold"},formatter:a=>"2024-2025"}),ue=P({data:[],digitalFlopStyle:{fontSize:14},color:["#5B8FF9","#5AD8A6","#F6BD16","#6F5EF9","#E86452","#945FB9","#FF9845","#1E9493"],showOriginValue:!0}),ge=P({data:[],rowNum:5,waitTime:3e3,carousel:"single",unit:"mm"}),xe=P({data:[],header:["测量时间","监测类型","仪器编号","测量值"],headerBGC:"rgba(11, 25, 55, 0.9)",oddRowBGC:"rgba(11, 25, 55, 0.7)",evenRowBGC:"rgba(16, 36, 78, 0.7)",headerHeight:40,rowNum:5,columnWidth:[120,80,70,70],align:["center","center","center","center"]});let b=null,j=null,J=new Map;const Ge=Ae(()=>q.value==="all"?W.value:W.value.filter(a=>a.type_id==q.value)),be=()=>{const a=new Date;he.value=a.toLocaleTimeString("zh-CN"),ye.value=a.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})},We=()=>{ve.push("/admin")},Ye=async()=>{try{await ct(),ve.push("/login")}catch(a){console.error("登出失败:",a)}},je=async()=>{try{await Promise.all([we(),Se(),Ce(),$e()]),Z.success("数据已刷新")}catch(a){console.error("刷新数据失败:",a),Z.error("刷新数据失败")}},we=async()=>{try{F.value=await ut(),ie.number=[F.value.total_measurements||0],re.number=[F.value.instrument_count||0];const a=F.value.type_statistics?F.value.type_statistics.length:0;ce.number=[a],F.value.type_statistics&&(ue.data=F.value.type_statistics.map(e=>({name:e.name,value:e.count})))}catch(a){console.error("加载统计数据失败:",a),ie.number=[0],re.number=[0],ce.number=[0],ue.data=[]}},Se=async()=>{try{_e.value=await dt()}catch(a){console.error("加载监测类型失败:",a)}},Ce=async()=>{try{const a=await mt(),e=[];for(const n of a)try{const i=await z({instrument_id:n.instrument_id,limit:1,order_by:"measure_time desc"});e.push({id:e.length+1,instrument_id:n.instrument_id,name:`仪器 ${n.instrument_id}`,type_id:n.type_id,type_name:n.type_name,latest_value:i.length>0?i[0].value:null,unit:n.unit||"mm"})}catch(i){console.error(`获取仪器 ${n.instrument_id} 最新数据失败:`,i),e.push({id:e.length+1,instrument_id:n.instrument_id,name:`仪器 ${n.instrument_id}`,type_id:n.type_id,type_name:n.type_name,latest_value:null,unit:n.unit||"mm"})}W.value=e}catch(a){console.error("加载仪器列表失败:",a)}},$e=async()=>{try{const a=await z({limit:10});Oe.value=a,xe.data=a.map(e=>[e.measure_time,e.type_name,e.instrument_id,`${e.value.toFixed(2)} ${e.unit}`])}catch(a){console.error("加载最新数据失败:",a)}},He=async a=>{try{const e=W.value.find(i=>i.instrument_id===a);if(!e)return;const n=await z({instrument_id:e.instrument_id,limit:20});K.value=n,ge.data=n.slice(0,5).map((i,p)=>({name:`测量${p+1}`,value:i.value.toFixed(2)})),await Pe(),Le(e.instrument_id)}catch(e){console.error("加载测点数据失败:",e),K.value=[],ge.data=[];const n=W.value.find(i=>i.instrument_id===a);n&&(await Pe(),Le(n.instrument_id))}},Le=a=>{ne.value&&(T&&T.dispose(),T=ee(ne.value),Me(a)),se.value&&(D&&D.dispose(),D=ee(se.value),qe(a))},qe=async a=>{if(D)try{const e=["2018","2019","2020","2021","2022","2023","2024"],n={};e.forEach(s=>{n[s]=0});for(const s of e)try{const m=`${s}-01-01 00:00:00`,l=`${s}-12-31 23:59:59`,c=await z({instrument_id:a,start_time:m,end_time:l,limit:1e3});n[s]=c.length}catch(m){console.error(`获取${s}年数据失败:`,m),n[s]=0}const i=e.map(s=>n[s]),p=Math.max(...i);let u=100;p>0&&(p>100?u=Math.ceil(p*1.2):u=Math.ceil(p*1.1)),D.setOption({title:{text:"仪器使用记录（2018-2024年）",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},tooltip:{trigger:"axis",formatter:s=>{const m=s[0].name,l=s[0].value;return`${m}: ${l} 条记录`}},xAxis:{type:"category",data:e.map(s=>`${s}年`),axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}}},yAxis:{type:"value",name:"记录数量",nameTextStyle:{color:"#a0cfff"},axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}},splitLine:{lineStyle:{color:"rgba(64, 158, 255, 0.1)"}},min:0,max:u},series:[{name:"使用记录",type:"bar",data:i,itemStyle:{color:new te(0,0,0,1,[{offset:0,color:"#F6BD16"},{offset:1,color:"#E86452"}])},label:{show:!0,position:"top",formatter:"{c}",color:"#fff"}}],grid:{left:"10%",right:"10%",bottom:"15%",top:"20%",containLabel:!0}})}catch(e){console.error("加载仪器使用记录失败:",e),D.setOption({title:{text:"仪器使用记录（2018-2024年）",subtext:"数据加载失败",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:[],axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"记录数量",nameTextStyle:{color:"#a0cfff"},min:0,max:100},series:[{name:"使用记录",type:"bar",data:[]}]})}},Me=async a=>{if(T)try{console.log("开始加载趋势数据，仪器ID:",a);const e=new Date("2024-12-31"),n=new Date("2024-12-31");$.value==="month"?n.setDate(n.getDate()-30):n.setFullYear(n.getFullYear()-1);const i=n.toISOString().replace("T"," ").substring(0,19),p=e.toISOString().replace("T"," ").substring(0,19);console.log("时间范围:",i,"到",p);const u=await z({instrument_id:a,start_time:i,end_time:p,limit:100});if(console.log("API返回数据:",u),!u||u.length===0){console.warn("API返回空数据，显示空图表"),T.setOption({title:{text:$.value==="month"?"最新一个月数据趋势":"最近一年数据趋势",subtext:"暂无数据",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:[],axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"测量值",nameTextStyle:{color:"#a0cfff"},min:0,max:100},series:[{name:"数据趋势",type:"line",data:[]}]});return}const s=[...u].sort((y,C)=>new Date(y.measure_time)-new Date(C.measure_time));console.log("排序后数据:",s);const m=s.map(y=>{const C=new Date(y.measure_time);return $.value==="month"?`${C.getMonth()+1}/${C.getDate()}`:`${C.getMonth()+1}月`}),l=s.map(y=>parseFloat(y.value.toFixed(2)));console.log("图表数据 - 时间:",m),console.log("图表数据 - 数值:",l);const c=l.filter(y=>!isNaN(y)),h=c.length>0?Math.min(...c):0,v=c.length>0?Math.max(...c):100;console.log("数据范围 - 最小值:",h,"最大值:",v);let w=0,S=100;if(c.length>0)if(h<0){const C=(v-h)*.1;w=Math.floor(h-C),S=Math.ceil(v+C)}else v<10?(w=0,S=Math.ceil(v*1.2)):v<100?(w=Math.floor(h*.8),S=Math.ceil(v*1.2)):(w=Math.floor(h*.9),S=Math.ceil(v*1.1));console.log("y轴范围 - 最小值:",w,"最大值:",S),T.setOption({title:{text:$.value==="month"?"最新一个月数据趋势":"最近一年数据趋势",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},tooltip:{trigger:"axis",formatter:y=>{var fe;const C=y[0].name,de=y[0].value,r=y[0].dataIndex;return`${((fe=s[r])==null?void 0:fe.measure_time)||C}: ${de}`}},xAxis:{type:"category",data:m,axisLabel:{color:"#a0cfff",rotate:$.value==="month"?45:0},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}}},yAxis:{type:"value",name:"测量值",nameTextStyle:{color:"#a0cfff"},axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}},splitLine:{lineStyle:{color:"rgba(64, 158, 255, 0.1)"}},min:w,max:S},series:[{name:"数据趋势",type:"line",data:l,smooth:!0,itemStyle:{color:"#6F5EF9"},lineStyle:{width:2},areaStyle:{color:new te(0,0,0,1,[{offset:0,color:"rgba(111, 94, 249, 0.6)"},{offset:1,color:"rgba(111, 94, 249, 0.1)"}])}}],grid:{left:"10%",right:"10%",bottom:$.value==="month"?"20%":"15%",top:"20%",containLabel:!0}}),console.log("图表渲染完成")}catch(e){console.error("加载趋势数据失败:",e),T.setOption({title:{text:$.value==="month"?"最新一个月数据趋势":"最近一年数据趋势",subtext:"数据加载失败",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:[],axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"测量值",nameTextStyle:{color:"#a0cfff"},min:0,max:100},series:[{name:"数据趋势",type:"line",data:[]}]})}},Ke=a=>{pe.value=a.id,M.value=a,He(a.instrument_id),Xe(a)},Je=()=>{ae.value&&(b=new Cesium.Viewer(ae.value,{animation:!1,timeline:!1,baseLayerPicker:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,fullscreenButton:!1,terrainProvider:new Cesium.EllipsoidTerrainProvider,imageryProvider:new Cesium.UrlTemplateImageryProvider({url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"})}),b.camera.setView({destination:Cesium.Cartesian3.fromDegrees(118.746,32.06,1e3),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-45),roll:0}}),Te(),Qe())},Te=()=>{if(!b)return;j&&(b.entities.remove(j),j=null);const a=Cesium.Cartesian3.fromDegrees(118.746,32.06,30);let e="/models/dam1.glb";R.value==="dam2"?e="/models/dam2.glb":R.value==="dam3"&&(e="/models/dam3.glb"),j=b.entities.add({position:a,model:{uri:e,scale:5,minimumPixelSize:128,maximumScale:100}}),b.zoomTo(j)},Qe=()=>{if(b){for(const a of J.values())b.entities.remove(a);J.clear()}},Xe=a=>{if(!b||!J.has(a.id))return;const e=J.get(a.id);b.flyTo(e,{duration:1.5,offset:new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-45),200)})},Ze=()=>{b&&b.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(118.746,32.06,1e3),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-45),roll:0},duration:1.5})},et=()=>{Y.value=!Y.value,Y.value?document.documentElement.requestFullscreen():document.exitFullscreen()},tt=()=>{le.value&&(E=ee(le.value),De()),oe.value&&(B=ee(oe.value),ze())},De=async()=>{if(E)try{const a=parseInt(V.value),e=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],n={};e.forEach(l=>{n[l]={sum:0,count:0}});for(let l=1;l<=12;l++)try{const c=`${a}-${String(l).padStart(2,"0")}-01 00:00:00`,h=`${a}-${String(l).padStart(2,"0")}-31 23:59:59`,v=await z({type_id:3,instrument_id:"上游",start_time:c,end_time:h,limit:100});if(v.length>0){const w=`${l}月`;n[w].sum=v.reduce((S,y)=>S+y.value,0),n[w].count=v.length}}catch(c){console.error(`获取${a}年${l}月上游水位数据失败:`,c)}const i=e.map(l=>{if(n[l].count>0){const c=n[l].sum/n[l].count;return parseFloat(c.toFixed(2))}return null});if(!i.some(l=>l!==null)){E.setOption({title:{text:`上游水位变化 (${V.value})`,subtext:"暂无数据",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},min:130,max:150},series:[{name:"上游水位",type:"line",data:i,connectNulls:!0}]});return}const u=i.filter(l=>l!==null&&!isNaN(l)),s=u.length>0?Math.min(...u):130,m=u.length>0?Math.max(...u):150;E.setOption({title:{text:`上游水位变化 (${V.value})`,left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},tooltip:{trigger:"axis",formatter:l=>{const c=l[0].name,h=l[0].value;return h!==null?`${c}: ${h} m`:`${c}: 无数据`}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}},splitLine:{lineStyle:{color:"rgba(64, 158, 255, 0.1)"}},min:Math.floor(s*.95),max:Math.ceil(m*1.05)},series:[{name:"上游水位",type:"line",data:i,smooth:!0,itemStyle:{color:"#5B8FF9"},lineStyle:{width:3},areaStyle:{color:new te(0,0,0,1,[{offset:0,color:"rgba(91, 143, 249, 0.6)"},{offset:1,color:"rgba(91, 143, 249, 0.1)"}])},connectNulls:!0}],grid:{left:"10%",right:"10%",bottom:"15%",top:"20%",containLabel:!0}})}catch(a){console.error("加载上游水位数据失败:",a);const e=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];E.setOption({title:{text:`上游水位变化 (${V.value})`,subtext:"数据加载失败",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},min:130,max:150},series:[{name:"上游水位",type:"line",data:[]}]})}},ze=async()=>{if(B)try{const a=parseInt(k.value),e=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],n={};e.forEach(l=>{n[l]={sum:0,count:0}});for(let l=1;l<=12;l++)try{const c=`${a}-${String(l).padStart(2,"0")}-01 00:00:00`,h=`${a}-${String(l).padStart(2,"0")}-31 23:59:59`,v=await z({type_id:3,instrument_id:"下游",start_time:c,end_time:h,limit:100});if(v.length>0){const w=`${l}月`;n[w].sum=v.reduce((S,y)=>S+y.value,0),n[w].count=v.length}}catch(c){console.error(`获取${a}年${l}月下游水位数据失败:`,c)}const i=e.map(l=>{if(n[l].count>0){const c=n[l].sum/n[l].count;return parseFloat(c.toFixed(2))}return null});if(!i.some(l=>l!==null)){B.setOption({title:{text:`下游水位变化 (${k.value})`,subtext:"暂无数据",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},min:120,max:140},series:[{name:"下游水位",type:"line",data:i,connectNulls:!0}]});return}const u=i.filter(l=>l!==null&&!isNaN(l)),s=u.length>0?Math.min(...u):120,m=u.length>0?Math.max(...u):140;B.setOption({title:{text:`下游水位变化 (${k.value})`,left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},tooltip:{trigger:"axis",formatter:l=>{const c=l[0].name,h=l[0].value;return h!==null?`${c}: ${h} m`:`${c}: 无数据`}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},axisLabel:{color:"#a0cfff"},axisLine:{lineStyle:{color:"rgba(64, 158, 255, 0.3)"}},splitLine:{lineStyle:{color:"rgba(64, 158, 255, 0.1)"}},min:Math.floor(s*.95),max:Math.ceil(m*1.05)},series:[{name:"下游水位",type:"line",data:i,smooth:!0,itemStyle:{color:"#E86452"},lineStyle:{width:3},areaStyle:{color:new te(0,0,0,1,[{offset:0,color:"rgba(232, 100, 82, 0.6)"},{offset:1,color:"rgba(232, 100, 82, 0.1)"}])},connectNulls:!0}],grid:{left:"10%",right:"10%",bottom:"15%",top:"20%",containLabel:!0}})}catch(a){console.error("加载下游水位数据失败:",a);const e=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];B.setOption({title:{text:`下游水位变化 (${k.value})`,subtext:"数据加载失败",left:"center",textStyle:{fontSize:12,color:"#a0cfff"}},xAxis:{type:"category",data:e,axisLabel:{color:"#a0cfff"}},yAxis:{type:"value",name:"水位 (m)",nameTextStyle:{color:"#a0cfff"},min:120,max:140},series:[{name:"下游水位",type:"line",data:[]}]})}};Fe([V,k],()=>{De(),ze()}),Fe($,()=>{M.value&&T&&Me(M.value.instrument_id)});const at=async()=>{if(M.value)try{const a=await z({instrument_id:M.value.instrument_id,limit:1e3}),i=[["测量时间","监测类型","仪器编号","测量值","单位","水位值"].join(","),...a.map(m=>[`"${m.measure_time}"`,`"${m.type_name}"`,`"${m.instrument_id}"`,m.value,`"${m.unit}"`,m.water_level||""].join(","))].join(`
`),p=new Blob([i],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a"),s=URL.createObjectURL(p);u.setAttribute("href",s),u.setAttribute("download",`${M.value.name}_${M.value.instrument_id}_数据.csv`),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u),Z.success("数据导出成功")}catch(a){console.error("导出数据失败:",a),Z.error("导出数据失败")}};return lt(async()=>{try{A.value=await ot()}catch(e){console.error("加载用户信息失败:",e);const n=localStorage.getItem("user_info");if(n)try{A.value=JSON.parse(n)}catch{A.value={username:"用户",role:"user"}}}be();const a=setInterval(be,1e3);await Promise.all([we(),Se(),Ce(),$e()]),Je(),tt(),document.addEventListener("fullscreenchange",()=>{Y.value=!!document.fullscreenElement}),nt(()=>{clearInterval(a),b&&b.destroy(),E&&E.dispose(),B&&B.dispose(),D&&D.dispose(),monthlyTrendChart&&monthlyTrendChart.dispose(),document.removeEventListener("fullscreenchange",()=>{})})}),(a,e)=>{const n=x("el-avatar"),i=x("el-button"),p=x("dv-digital-flop"),u=x("dv-active-ring-chart"),s=x("el-option"),m=x("el-select"),l=x("dv-border-box-8"),c=x("el-radio-button"),h=x("el-radio-group"),v=x("el-table-column"),w=x("el-table"),S=x("dv-border-box-10"),y=x("dv-scroll-board"),C=x("dv-border-box-12"),de=x("dv-border-box-13");return N(),H("div",{class:L(["monitor-container",{fullscreen:Y.value}])},[t("div",{ref_key:"viewerEl",ref:ae,class:"cesium-viewer"},null,512),t("div",vt,[e[11]||(e[11]=t("div",{class:"title-section"},[t("h1",null,"智慧水利大坝安全监测平台"),t("p",{class:"subtitle"},"实时监测 · 三维可视化 · 数据分析")],-1)),t("div",_t,[t("div",pt,[o(n,{size:36,src:Ne.value},null,8,["src"]),t("div",ht,[t("div",yt,_(A.value.name||A.value.username),1),t("div",gt,_(A.value.role==="admin"?"管理员":"普通用户"),1)]),st(it)?(N(),Ve(i,{key:0,type:"primary",size:"small",onClick:We},{default:f(()=>[...e[9]||(e[9]=[g("后台管理",-1)])]),_:1})):ke("",!0),o(i,{size:"small",onClick:Ye},{default:f(()=>[...e[10]||(e[10]=[g("退出",-1)])]),_:1})]),t("div",xt,[t("div",bt,_(he.value),1),t("div",wt,_(ye.value),1)])])]),o(l,{class:L(["floating-window left-window overview-window",{collapsed:I.value}])},{default:f(()=>[t("div",St,[e[13]||(e[13]=t("h3",null,[t("i",{class:"el-icon-monitor"}),g(" 监测概览")],-1)),t("div",Ct,[o(i,{size:"small",onClick:je},{default:f(()=>[...e[12]||(e[12]=[t("i",{class:"el-icon-refresh"},null,-1),g(" 刷新 ",-1)])]),_:1}),o(i,{size:"small",onClick:e[0]||(e[0]=r=>I.value=!I.value)},{default:f(()=>[t("i",{class:L(I.value?"el-icon-full-screen":"el-icon-crop")},null,2),g(" "+_(I.value?"展开":"收起"),1)]),_:1})])]),Q(t("div",$t,[t("div",Lt,[t("div",Mt,[o(p,{config:ie},null,8,["config"]),e[14]||(e[14]=t("div",{class:"stat-label"},"总测量记录",-1))]),t("div",Tt,[o(p,{config:re},null,8,["config"]),e[15]||(e[15]=t("div",{class:"stat-label"},"监测仪器",-1))]),t("div",Dt,[o(p,{config:ce},null,8,["config"]),e[16]||(e[16]=t("div",{class:"stat-label"},"监测类型",-1))]),t("div",zt,[o(p,{config:Ue},null,8,["config"]),e[17]||(e[17]=t("div",{class:"stat-label"},"最新数据年度",-1))])]),t("div",At,[e[18]||(e[18]=t("h4",null,"监测类型分布",-1)),o(u,{config:ue,class:"chart-container"},null,8,["config"])]),t("div",Ft,[t("div",Vt,[t("div",kt,[e[19]||(e[19]=t("h4",null,"上游水位变化趋势",-1)),t("div",Et,[o(m,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=r=>V.value=r),placeholder:"年份",size:"small",style:{width:"100px"}},{default:f(()=>[o(s,{label:"2018",value:"2018"}),o(s,{label:"2019",value:"2019"}),o(s,{label:"2020",value:"2020"}),o(s,{label:"2021",value:"2021"}),o(s,{label:"2022",value:"2022"}),o(s,{label:"2023",value:"2023"}),o(s,{label:"2024",value:"2024"})]),_:1},8,["modelValue"])])]),t("div",{ref_key:"upstreamChartEl",ref:le,class:"chart-container"},null,512)]),t("div",Bt,[t("div",Pt,[e[20]||(e[20]=t("h4",null,"下游水位变化趋势",-1)),t("div",Nt,[o(m,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=r=>k.value=r),placeholder:"年份",size:"small",style:{width:"100px"}},{default:f(()=>[o(s,{label:"2018",value:"2018"}),o(s,{label:"2019",value:"2019"}),o(s,{label:"2020",value:"2020"}),o(s,{label:"2021",value:"2021"}),o(s,{label:"2022",value:"2022"}),o(s,{label:"2023",value:"2023"}),o(s,{label:"2024",value:"2024"})]),_:1},8,["modelValue"])])]),t("div",{ref_key:"downstreamChartEl",ref:oe,class:"chart-container"},null,512)])])],512),[[X,!I.value]])]),_:1},8,["class"]),o(S,{class:L(["floating-window right-window points-window",{collapsed:O.value}])},{default:f(()=>[t("div",Rt,[e[21]||(e[21]=t("h3",null,[t("i",{class:"el-icon-location-information"}),g(" 测点数据")],-1)),t("div",It,[o(m,{modelValue:q.value,"onUpdate:modelValue":e[3]||(e[3]=r=>q.value=r),placeholder:"类型筛选",size:"mini",style:{width:"100px"}},{default:f(()=>[o(s,{label:"全部",value:"all"}),(N(!0),H(Ee,null,Be(_e.value,r=>(N(),Ve(s,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(i,{size:"small",onClick:e[4]||(e[4]=r=>O.value=!O.value)},{default:f(()=>[t("i",{class:L(O.value?"el-icon-full-screen":"el-icon-crop")},null,2),g(" "+_(O.value?"展开":"收起"),1)]),_:1})])]),Q(t("div",Ot,[t("div",Ut,[(N(!0),H(Ee,null,Be(Ge.value,r=>{var me;return N(),H("div",{key:r.id,class:L(["point-item",{active:pe.value===r.id}]),onClick:fe=>Ke(r)},[t("div",Wt,[t("div",Yt,_(r.name),1),t("div",jt,[t("span",Ht,_(r.type_name),1),t("span",qt,"仪器: "+_(r.instrument_id),1)])]),t("div",Kt,[t("div",Jt,_(((me=r.latest_value)==null?void 0:me.toFixed(2))||"--"),1),t("div",Qt,_(r.unit||""),1)])],10,Gt)}),128))]),M.value?(N(),H("div",Xt,[t("div",Zt,[t("div",ea,[e[24]||(e[24]=t("h4",null,"最新数据趋势",-1)),t("div",ta,[o(h,{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=r=>$.value=r),size:"mini"},{default:f(()=>[o(c,{label:"month"},{default:f(()=>[...e[22]||(e[22]=[g("一个月",-1)])]),_:1}),o(c,{label:"year"},{default:f(()=>[...e[23]||(e[23]=[g("一年",-1)])]),_:1})]),_:1},8,["modelValue"])])]),t("div",{ref_key:"trendChartEl",ref:ne,class:"chart-container",style:{height:"200px"}},null,512)]),t("div",aa,[e[25]||(e[25]=t("div",{class:"chart-header"},[t("h4",null,"仪器使用记录（2018-2024年）")],-1)),t("div",{ref_key:"usageChartEl",ref:se,class:"chart-container",style:{height:"200px"}},null,512)]),t("div",la,[t("div",oa,[e[27]||(e[27]=t("h4",null,"历史数据",-1)),t("div",na,[o(i,{size:"mini",onClick:at,type:"primary"},{default:f(()=>[...e[26]||(e[26]=[t("i",{class:"el-icon-download"},null,-1),g(" 导出CSV ",-1)])]),_:1})])]),t("div",sa,[o(w,{data:K.value,size:"mini",height:"200"},{default:f(()=>[o(v,{prop:"measure_time",label:"测量时间",width:"150"}),o(v,{prop:"type_name",label:"监测类型",width:"100"}),o(v,{prop:"instrument_id",label:"仪器编号",width:"100"}),o(v,{prop:"value",label:"测量值",width:"100"},{default:f(({row:r})=>[g(_(r.value.toFixed(2))+" "+_(r.unit),1)]),_:1}),o(v,{prop:"water_level",label:"水位值",width:"100"},{default:f(({row:r})=>[g(_(r.water_level?r.water_level.toFixed(2):"--"),1)]),_:1})]),_:1},8,["data"]),t("div",ia," 共 "+_(K.value.length)+" 条记录，显示最近20条 ",1)])])])):ke("",!0)],512),[[X,!O.value]])]),_:1},8,["class"]),o(C,{class:L(["floating-window bottom-window latest-data-window",{collapsed:U.value}])},{default:f(()=>[t("div",ra,[e[28]||(e[28]=t("h3",null,[t("i",{class:"el-icon-s-data"}),g(" 最新监测数据")],-1)),t("div",ca,[o(i,{size:"small",onClick:e[6]||(e[6]=r=>U.value=!U.value)},{default:f(()=>[t("i",{class:L(U.value?"el-icon-full-screen":"el-icon-crop")},null,2),g(" "+_(U.value?"展开":"收起"),1)]),_:1})])]),Q(t("div",ua,[t("div",da,[o(y,{config:xe},null,8,["config"])])],512),[[X,!U.value]])]),_:1},8,["class"]),o(de,{class:L(["floating-window model-control-window",{collapsed:G.value}])},{default:f(()=>[t("div",ma,[e[29]||(e[29]=t("h3",null,[t("i",{class:"el-icon-map-location"}),g(" 模型控制")],-1)),t("div",fa,[o(i,{size:"small",onClick:e[7]||(e[7]=r=>G.value=!G.value)},{default:f(()=>[t("i",{class:L(G.value?"el-icon-full-screen":"el-icon-crop")},null,2),g(" "+_(G.value?"展开":"收起"),1)]),_:1})])]),Q(t("div",va,[t("div",_a,[o(m,{modelValue:R.value,"onUpdate:modelValue":e[8]||(e[8]=r=>R.value=r),placeholder:"选择模型",size:"mini",onChange:Te},{default:f(()=>[o(s,{label:"大坝模型1 (dam1.glb)",value:"dam1"}),o(s,{label:"大坝模型2 (dam2.glb)",value:"dam2"}),o(s,{label:"大坝模型3 (dam3.glb)",value:"dam3"})]),_:1},8,["modelValue"]),o(i,{size:"mini",onClick:Ze},{default:f(()=>[...e[30]||(e[30]=[g("重置视角",-1)])]),_:1}),o(i,{size:"mini",onClick:et},{default:f(()=>[...e[31]||(e[31]=[t("i",{class:"el-icon-full-screen"},null,-1),g(" 全屏 ",-1)])]),_:1})]),t("div",pa,[t("div",ha,[e[32]||(e[32]=t("span",{class:"label"},"当前模型：",-1)),t("span",ya,_(Re[R.value]),1)]),t("div",ga,[e[33]||(e[33]=t("span",{class:"label"},"模型格式：",-1)),t("span",xa,_(Ie[R.value]),1)])])],512),[[X,!G.value]])]),_:1},8,["class"])],2)}}},La=ft(ba,[["__scopeId","data-v-5e0a2b49"]]);export{La as default};
